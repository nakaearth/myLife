/* 	Twitter Friends v1.0
	Blog : http://www.moretechtips.net
	Project: http://code.google.com/p/twitter-friends-widget/
	Copyright 2009 [Mike @ moretechtips.net] 
	Licensed under the Apache License, Version 2.0 
	(the "License"); you may not use this file except in compliance with the License. 
	You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 
*/
(function($){$.fn.twitterFriends=function(allOptions){var defaults={debug:0,username:"",friends:0,users:20,users_max:100,loop:0,user_link:0,user_image:48,user_animate:"opacity",user_change:200,user_swap:5e3,user_append:1,header:"",tweet:0,tweet_avatar:1,tweet_author:0,tweet_date:1,tweet_source:1,tweet_image:48,tweet_stay:5e3,tweet_change:200,tweet_animate:"opacity",info:""};return allOptions=$.extend({},defaults,allOptions),this.each(function(){var wasOutput=0,rs=[],vp=-1,ai=-1,si=-1,div=$(this),usrsDiv=null,stsDiv=null,hdDiv=null,op=allOptions;if(div.attr("options")){try{op=eval("("+div.attr("options")+")")}catch(e){div.html('<b style="color:red">'+e+"</b>");return}op=$.extend({},defaults,op)}var requestUsers=function(){var a=op.friends?"http://api.twitter.com/1/statuses/friends.json":"http://api.twitter.com/1/statuses/followers.json",b={screen_name:op.username,cursor:-1};$.ajax({url:a,data:b,success:requestedUsers,dataType:"jsonp",cache:!0})},requestedUsers=function(a){if(!a.users){op.debug&&div.html('<b style="color:red">Error:'+(a.error?a.error:"unkown")+"</b>");return}rs=a.users;if(rs.length==0)return;rs.length>op.users_max&&(rs.length=op.users_max),rs=rs.reverse(),output(),vp=-1,addUsers()},addUsers=function(){if((vp+1)*op.users>=rs.length)if(op.loop)vp=-1;else return;usrsDiv.html(""),vp++;for(var a=vp*op.users;a<(vp+1)*op.users;a++){if(a>=rs.length)break;addUser(rs[a],a)}ai=op.user_append?-1:$("a",usrsDiv).length,showUser(),si=-1,op.tweet&&hideStatus()},addUser=function(a,b){var c=op.user_link&&a.url?a.url:"http://twitter.com/"+a.screen_name,d=a.name+(a.status&&op.tweet?": "+a.status.text:"");d=d.replace(/"/g,"&quot;").replace(/'/g,"&#39;"),$('<a style="display:none;height:'+op.user_image+'px" href="'+c+'" title="'+d+'">'+'<img src="'+a.profile_image_url+'" border="0" height="'+op.user_image+'" width="'+op.user_image+'"/>'+"</a>").appendTo(usrsDiv)},showUser=function(){ai=op.user_append?ai+1:ai-1;var a=$("a:eq("+ai+")",usrsDiv);if(!a.length){op.tweet||usrsDiv.animate({opacity:1},op.user_swap,"linear",addUsers);return}var b=new Object;b[op.user_animate]="show",a.animate(b,op.user_change,"linear",showUser)},addStatus=function(a,b){var c=op.user_link&&a.url?a.url:"http://twitter.com/"+a.screen_name,d=a.name;stsDiv.html('<div style="display:none;">'+(op.tweet_avatar?'<span class="tf-avatar"><a href="'+c+'" title="'+d+'">'+'<img src="'+a.profile_image_url+'" height="'+op.tweet_image+'" width="'+op.tweet_image+'" border="0"/>'+"</a>"+"</span>":"")+'<span class="tf-body">'+(op.tweet_author?'<strong><a href="'+c+'" title="'+d+'">'+a.screen_name+"</a>"+"</strong>":"")+'<span class="tf-content">'+linkify(b.text)+"</span>"+'<span class="tf-meta">'+(op.tweet_date?'<a class="tf-date" href="http://twitter.com/'+a.screen_name+"/status/"+b.id+'">'+formatDate(b.created_at)+"</a>":"")+(op.tweet_source?'<span class="tf-source"> from '+decodeHTML(b.source)+"</span>":"")+"</span>"+"</span>"+"</div>")},hideStatus=function(){si>-1?$("div",stsDiv).fadeOut(op.tweet_change,showStatus):showStatus()},showStatus=function(){var a=null,b=null;while(!b){si++;if(si>=$("a",usrsDiv).length){addUsers();return}a=rs[vp*op.users+si],b=a.status}addStatus(a,b);var c=new Object;c[op.tweet_animate]="show",$("div",stsDiv).animate(c,op.tweet_change,"linear",stayStatus)},stayStatus=function(){$("div",stsDiv).animate({opacity:1},op.tweet_stay,"linear",hideStatus)},linkify=function(a){return a.replace(/\bhttps?\:\/\/\S+/gi,function(a){var b="";return a=a.replace(/(\.*|\?*|\!*)$/,function(a,d){return b=d,""}),'<a class="tf-link" href="'+a+'">'+(a.length>25?a.substr(0,24)+"...":a)+"</a>"+b}).replace(/\B\@([A-Z0-9_]{1,15})/gi,'@<a class="tf-at" href="http://twitter.com/$1">$1</a>').replace(/\B\#([A-Z0-9_]+)/gi,'<a class="tf-hashtag" href="http://search.twitter.com/search?q=%23$1">#$1</a>')},decodeHTML=function(a){return a.replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"')},formatDate=function(a){/^(\w\w\w) (\w\w\w) (\d\d?) (\d\d?:\d\d?:\d\d?) ([\+\-]\d+) (\d\d\d\d)$/i.test(a)&&(a=a.replace(/^(\w\w\w) (\w\w\w) (\d\d?) (\d\d?:\d\d?:\d\d?) ([\+\-]\d+) (\d\d\d\d)$/i,"$1, $3 $2 $6 $4 $5"));var b=new Date,c=new Date;b.setTime(Date.parse(a));var d=c.getDate(),e=c.getMonth()+1,f=c.getFullYear(),g=c.getHours(),h=c.getMinutes(),i=c.getSeconds(),j=b.getDate(),k=b.getMonth()+1,l=b.getFullYear(),m=b.getHours(),n=b.getMinutes(),a=b.getSeconds();if(l==f&&k==e&&j==d){var o=g-m;if(o>0)return o+" hour"+(o>1?"s":"")+" ago";var p=h-n;if(p>0)return p+" minute"+(p>1?"s":"")+" ago";var q=i-a;return q+" second"+(q>1?"s":"")+" ago"}return k+"/"+j+"/"+l},requestMe=function(){$.ajax({url:"http://api.twitter.com/1/users/show.json",data:{screen_name:op.username},success:requestedMe,dataType:"jsonp",cache:!0})},requestedMe=function(a){output();if(!a.screen_name){op.debug&&hdDiv.html('<b style="color:red">Error:'+(a.error?a.error:"unkown")+"</b>");return}hdDiv.html(op.header.replace(/_tp_/g,"http://twitter.com/"+a.screen_name).replace(/_fr_/g,a.friends_count).replace(/_fo_/g,a.followers_count).replace(/_ti_/g,a.profile_image_url))},init=function(){op.header&&requestMe(),requestUsers()},output=function(){if(wasOutput)return;wasOutput=1,div.html(""),op.info&&div.append(op.info),op.header&&(hdDiv=$('<div class="tf-header"></div>').appendTo(div)),usrsDiv=$('<div class="tf-users"></div>').appendTo(div),op.tweet&&(stsDiv=$('<div class="tf-tweet"></div>').appendTo(div))};init()})}})(jQuery),jQuery(document).ready(function(){jQuery("div.twitter-friends").twitterFriends()})