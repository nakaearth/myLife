/**
@fileOverview LuvDaSun Coulisse
@author <a href="mailto:elmerbulthuis@gmail.com">Elmer Bulthuis</a>
@version 0.8.2
@license LuvDaSun Coulisse - v0.8.3 - 2011-11-16

http://coulisse.luvdasun.com/

Copyright 2010-2011 "Elmer Bulthuis" <elmerbulthuis@gmail.com>
Dual licensed under the MIT and GPL licenses.

This project was made possible by its sponsors:

Anna Renaudin - www.annarenaudin.net
GrÃ©goire Rist - www.expeo.net
*/
/**
@namespace
*/
typeof lds=="undefined"&&(lds={}),function(a){function b(a,b,c){var d=c/2;while(a>b+d)a-=c;while(a<b-d)a+=c;return a}function c(a,b){a%=b;while(a<0)a+=b;return a}var d=function(a,b){if(!b)return a;var c=typeof b;switch(c){case"function":return b.apply(a);case"string":case"number":var e=a[b],f=typeof e;switch(f){case"function":return e();default:return e}break;case"object":switch(b.constructor){case Array:return b.length==0?a:d(d(a,b[0]),b.slice(1));default:throw"unknown object is not supported as a getter"}break;default:throw c+" is not supported as a getter"}},e=function(a,b,c){if("addEventListener"in a)a.addEventListener(b,c,!1);else if("attachEvent"in a)a.attachEvent("on"+b,c);else throw""+b+" event could not be bound"},f=function(a,b,c){if("removeEventListener"in a)a.removeEventListener(b,c,!1);else if("detachEvent"in a)a.detachEvent("on"+b,c);else throw""+b+" event could not be unbound"},g=0,h={},i=function(a,b,c,d,e,f){var i=++g,j=b-a,k=(new Date).getTime(),l=function(){var g=(new Date).getTime(),m=g-k;if(m<e){var n=d(a,b,j,m,e);c(n,!1),h[i]=window.setTimeout(l,f)}else delete h[i],c(b,!0)};return l(),i},j=function(a){window.clearTimeout(h[a]),delete h[a]},k=function(a,b,c,d){var e=a.canvas.width,f=a.canvas.height,g=b.width,h=b.height;d=d||e;for(var i=0;i<d;i++){var j=Math.floor(g*i/d),k=Math.ceil(g*(i+1)/d),l=Math.floor(e*i/d),m=Math.ceil(e*(i+1)/d),n=c*f*(d-i-1)/(d-1);a.drawImage(b,j,0,k-j,h,l,n/2,m-l,f-n)}},l=function(a,b,c,d){var e=a.canvas.width,f=a.canvas.height,g=b.width,h=b.height;d=d||e;for(var i=0;i<d;i++){var j=Math.floor(g*i/d),k=Math.ceil(g*(i+1)/d),l=Math.floor(e*i/d),m=Math.ceil(e*(i+1)/d),n=c*f*i/(d-1);a.drawImage(b,j,0,k-j,h,l,n/2,m-l,f-n)}};a.Coulisse=function(a,g){var h=this,m=g.cyclic||!1,n=g.duration||800,o=g.interval||20,p=g.sliceCount||10,q=g.area||.5,r=g.pinch||.2,s=g.scale||.4,t=g.activeSize||800,u=g.inactiveSize||400,v=g.activateEvent||"click",w=g.onActivateIndex||null,x=g.onIndexChange||null,y=g.onIndexChanging||null,z=g.onIndexChanged||null,A=g.imageSrcGetter||null,B=g.linkHrefGetter||null,C=[],D=function(b,d,g){var i=this,j=null,m=document.createElement("img"),n=g?document.createElement("a"):null,o=typeof HTMLCanvasElement=="undefined"?null:document.createElement("canvas"),x=o?o.getContext("2d"):null,y=!1,z=o||m,A=n||z,B=A.style,D=function(a){if(L!=b)return(!w||w({index:c(b,C.length)})!==!1)&&h.setIndex(b),"preventDefault"in a&&a.preventDefault(),!1},F=function(b){var c=m.width*m.width,d=m.height*m.height,e=c+d,f=Math.sqrt(e);i.activePanelWidth=m.width*t/f,i.activePanelHeight=m.height*t/f,i.inactivePanelWidth=s*m.width*u/f,i.inactivePanelHeight=m.height*u/f,i.deltaWidth=i.activePanelWidth-i.inactivePanelWidth,i.deltaHeight=i.activePanelHeight-i.inactivePanelHeight,n&&n.appendChild(z),a.appendChild(A),y=!0,E(!0)};this.update=function(c,d){var e=!0;if(!y)return e;var f=!0,g=c.panelCount-Math.abs(Math.round(d));if(d<0){if(d>-1){var h=C[(b+1)%c.panelCount];z.width=i.inactivePanelWidth+i.deltaWidth*c.realIndexModInv,z.height=i.inactivePanelHeight+i.deltaHeight*c.realIndexModInv,x&&l(x,m,r*c.realIndexMod,p),c.panelLeft=(a.offsetWidth-i.activePanelWidth)/2,c.panelLeft-=i.inactivePanelWidth*q*c.realIndexMod,c.panelLeft-=(h.activePanelWidth-i.activePanelWidth)/2*c.realIndexMod}else j>-1&&(z.width=i.inactivePanelWidth,z.height=i.inactivePanelHeight,x&&l(x,m,r)),f=c.panelLeft>=0-z.width,c.panelLeft-=z.width*q;f&&(B.left=c.panelLeft+"px",B.right="")}else if(d>0){if(d<1){var h=C[(b+c.panelCount-1)%c.panelCount];z.width=i.inactivePanelWidth+i.deltaWidth*c.realIndexMod,z.height=i.inactivePanelHeight+i.deltaHeight*c.realIndexMod,x&&k(x,m,r*c.realIndexModInv,p),c.panelRight=(a.offsetWidth-i.activePanelWidth)/2,c.panelRight-=i.inactivePanelWidth*q*c.realIndexModInv,c.panelRight-=(h.activePanelWidth-i.activePanelWidth)/2*c.realIndexModInv}else j<1&&(z.width=i.inactivePanelWidth,z.height=i.inactivePanelHeight,x&&k(x,m,r)),f=c.panelRight>=0-z.width,c.panelRight-=z.width*q;f&&(B.left="",B.right=c.panelRight+"px")}else z.width=i.activePanelWidth,z.height=i.activePanelHeight,x&&x.drawImage(m,0,0,m.width,m.height,0,0,z.width,z.height),c.panelLeft=(a.offsetWidth-i.activePanelWidth)/2,c.panelRight=(a.offsetWidth-i.activePanelWidth)/2,f&&(B.left=c.panelLeft+"px",B.right=c.panelRight+"px");return f?(B.zIndex=g,B.top=B.bottom=(a.offsetHeight-z.height)/2+"px",B.display="block"):(e=B.display!="none",B.display="none"),j=d,e},this.destruct=function(){f(A,v,D),f(m,"load",F),a.removeChild(A),delete A,delete m,delete o},e(A,v,D),e(m,"load",F),B.display="none",B.position="absolute",n&&(n.href=g),m.src=d},E=function(a){var b=C.length;if(!b)return;var d=c(M,b),e={panelLeft:null,panelRight:null,panelCount:b,realIndexInt:parseInt(M),realIndexMod:d%1,realIndexModInv:1-d%1},d=parseInt(d);if(m){var f=parseInt(b/2),g=b-f;for(var h=0;h<f;h++){var i=d;i-=h;if(!m&&i<0)break;while(b&&i<0)i+=b;var j=C[i],k=i-M;while(k<0-f)k+=b;while(k>0+g)k-=b;if(!j.update(e,k)&&!a)break}for(var l=1;l<g;l++){var i=d;i+=l;if(!m&&i>=b)break;while(i>=b)i-=b;var j=C[i],k=i-M;while(k<0-f)k+=b;while(k>0+g)k-=b;if(!j.update(e,k)&&!a)break}}else{for(var i=e.realIndexInt;i>=0;i--){var j=C[i];if(j&&!j.update(e,i-M)&&!a)break}for(var i=e.realIndexInt+1;i<e.panelCount;i++){var j=C[i];if(j&&!j.update(e,i-M)&&!a)break}}},F=function(){E(!0)},G=function(a,b){var d=Math.round(a);L!=d&&(L=d,y&&y({index:c(L,C.length)})),M!=a&&(M=a,E(!1)),b&&K()},H=g.animationCalculate||function(a,b,c,d,e){return a+c*Math.sin(Math.PI*d/e/2)},I,J=function(a){var b=Math.round(a);x&&x({index:c(b,C.length)}),I=i(M,b,G,H,n,o)},K=function(){I&&(j(I),I=null,z&&z({index:c(L,C.length)}))},L=g.index||0,M=L;this.setIndex=function(a){K(),J(m?b(a,M,C.length):c(a,C.length))},this.getIndex=function(){return c(L,C.length)},this.destruct=function(){K(),f(window,"resize",F);for(var a=C.pop();a;a=C.pop())a.destruct(),delete a},this.addImages=function(a){for(var b=0,c=a.length;b<c;b++){var e=a[b],f=d(e,A),h=g.linkHrefGetter?d(e,B):null,i=C.length,j=new D(i,f,h);C[i]=j}},this.countImages=function(a){return C.length},g.images&&this.addImages(g.images),e(window,"resize",F),delete g}}(lds)